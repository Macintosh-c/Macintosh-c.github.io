
 <!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  
    <title>RabbitMq集群搭建 | macintosh-c&#39;s blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1,user-scalable=no">
    
    <meta name="author" content="Macintosh-c">
    

    
    <meta name="description" content="RabbiMQ简介 RabbiMQ是用Erang开发的，集群非常方便，因为Erlang天生就是一门分布式语言，但其本身并不支持负载均衡。  RabbiMQ模式 RabbitMQ模式大概分为以下三种:(1)单一模式。(2)普通模式(默认的集群模式)。(3) 镜像模式(把需要的队列做成镜像队列，存在于多个节点，属于RabbiMQ的HA方案，在对业务可靠性要求较高的场合中比较适用)。要实现镜像模式，需要">
<meta name="keywords" content="rabbitmq安装">
<meta property="og:type" content="article">
<meta property="og:title" content="RabbitMq集群搭建">
<meta property="og:url" content="http://macintosh-c.coding.me/2020/06/12/mq/RabbitMQ/RabbitMq集群搭建/index.html">
<meta property="og:site_name" content="macintosh-c&#39;s blog">
<meta property="og:description" content="RabbiMQ简介 RabbiMQ是用Erang开发的，集群非常方便，因为Erlang天生就是一门分布式语言，但其本身并不支持负载均衡。  RabbiMQ模式 RabbitMQ模式大概分为以下三种:(1)单一模式。(2)普通模式(默认的集群模式)。(3) 镜像模式(把需要的队列做成镜像队列，存在于多个节点，属于RabbiMQ的HA方案，在对业务可靠性要求较高的场合中比较适用)。要实现镜像模式，需要">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://macintosh-c.coding.me/img/RabbitMQ/rabbitmq.png">
<meta property="og:updated_time" content="2020-06-12T17:53:42.366Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RabbitMq集群搭建">
<meta name="twitter:description" content="RabbiMQ简介 RabbiMQ是用Erang开发的，集群非常方便，因为Erlang天生就是一门分布式语言，但其本身并不支持负载均衡。  RabbiMQ模式 RabbitMQ模式大概分为以下三种:(1)单一模式。(2)普通模式(默认的集群模式)。(3) 镜像模式(把需要的队列做成镜像队列，存在于多个节点，属于RabbiMQ的HA方案，在对业务可靠性要求较高的场合中比较适用)。要实现镜像模式，需要">
<meta name="twitter:image" content="http://macintosh-c.coding.me/img/RabbitMQ/rabbitmq.png">

    
    <link rel="alternative" href="/atom.xml" title="macintosh-c&#39;s blog" type="application/atom+xml">
    
    
    <link rel="icon" href="/img/favicon.ico">
    
    
    <link rel="apple-touch-icon" href="/img/jacman.jpg">
    <link rel="apple-touch-icon-precomposed" href="/img/jacman.jpg">
    
    <link rel="stylesheet" href="/css/style.css">
</head>

  <body>
    <header>
      
<div>
		
			<div id="imglogo">
				<a href="/"><img src="/img/logo_me.jpg" alt="macintosh-c&#39;s blog" title="macintosh-c&#39;s blog"/></a>
			</div>
			
			<div id="textlogo">
				<h1 class="site-name"><a href="/" title="macintosh-c&#39;s blog">macintosh-c&#39;s blog</a></h1>
				<h2 class="blog-motto">当你的才华撑不起你的野心时，就应该静下心来好好学习。</h2>
			</div>
			<div class="navbar"><a class="navbutton navmobile" href="#" title="菜单">
			</a></div>
			<nav class="animated">
				<ul>
					<ul>
					 
						<li><a href="/">首页(Home)</a></li>
					
						<li><a href="/archives">归档(Archives)</a></li>
					
						<li><a href="/tags">标签(Tags)</a></li>
					
						<li><a href="/categories">分类(Categories)</a></li>
					
					<li>
 					
						<script type="text/javascript">(function(){document.write(unescape('%3Cdiv id="bdcs"%3E%3C/div%3E'));var bdcs = document.createElement('script');bdcs.type = 'text/javascript';bdcs.async = true;bdcs.src = 'http://znsv.baidu.com/customer_search/api/js?sid=10231555544562790968' + '&plate_url=' + encodeURIComponent(window.location.href) + '&t=' + Math.ceil(new Date()/3600000);var s = document.getElementsByTagName('script')[0];s.parentNode.insertBefore(bdcs, s);})();</script>
					
					</li>
				</ul>
			</nav>
</div>

    </header>
    <div id="container">
      <div id="main" class="post" itemscope itemprop="blogPost">
  
	<article itemprop="articleBody">
		<header class="article-info clearfix">
  <h1 itemprop="name">
    
      <a href="/2020/06/12/mq/RabbitMQ/RabbitMq集群搭建/" title="RabbitMq集群搭建" itemprop="url">RabbitMq集群搭建</a>
  </h1>
  <p class="article-author">By
       
		<a href="/about" title="Macintosh-c" target="_blank" itemprop="author">Macintosh-c</a>
		
  <p class="article-time">
    <time datetime="2020-06-12T14:14:52.000Z" itemprop="datePublished"> 发表于 2020-06-12</time>
		<span id="busuanzi_container_page_pv"> 总阅读 <span id="busuanzi_value_page_pv"></span> </span> 次
  </p>
</header>

	<div class="article-content">
		
		<div id="toc" class="toc-article">
			<strong class="toc-title">文章目录</strong>
		
			<ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbiMQ简介"><span class="toc-number">1.</span> <span class="toc-text">RabbiMQ简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbiMQ模式"><span class="toc-number">2.</span> <span class="toc-text">RabbiMQ模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbiMQ特点"><span class="toc-number">3.</span> <span class="toc-text">RabbiMQ特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建环境："><span class="toc-number">4.</span> <span class="toc-text">搭建环境：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建步骤"><span class="toc-number">5.</span> <span class="toc-text">搭建步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-配置hosts文件"><span class="toc-number">5.1.</span> <span class="toc-text">1. 配置hosts文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-安装erlang和rabbitmq-server软件"><span class="toc-number">5.2.</span> <span class="toc-text">2.安装erlang和rabbitmq-server软件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-修改rabbitmq-config配置"><span class="toc-number">5.3.</span> <span class="toc-text">3.修改rabbitmq config配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-安装管理插件"><span class="toc-number">5.4.</span> <span class="toc-text">4. 安装管理插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-调整最大可打开文件句柄限制"><span class="toc-number">5.5.</span> <span class="toc-text">5. 调整最大可打开文件句柄限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-拷贝erlang-cookie"><span class="toc-number">5.6.</span> <span class="toc-text">6.拷贝erlang.cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-将mq02、mq03作为内存节点加入mq01节点集群中"><span class="toc-number">5.7.</span> <span class="toc-text">7.将mq02、mq03作为内存节点加入mq01节点集群中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-查看集群状态"><span class="toc-number">5.8.</span> <span class="toc-text">8.查看集群状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-RabbitMQ镜像集群配置"><span class="toc-number">5.9.</span> <span class="toc-text">9.RabbitMQ镜像集群配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-其他功能指令使用"><span class="toc-number">5.10.</span> <span class="toc-text">10.其他功能指令使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-rabbitmq网络分区配置-脑裂详解"><span class="toc-number">5.11.</span> <span class="toc-text">11.rabbitmq网络分区配置-脑裂详解</span></a></li></ol></li></ol>
		
		</div>
		
		<h3 id="RabbiMQ简介"><a href="#RabbiMQ简介" class="headerlink" title="RabbiMQ简介"></a>RabbiMQ简介</h3><blockquote>
<p>RabbiMQ是用Erang开发的，集群非常方便，因为Erlang天生就是一门分布式语言，但其本身并不支持负载均衡。</p>
</blockquote>
<h3 id="RabbiMQ模式"><a href="#RabbiMQ模式" class="headerlink" title="RabbiMQ模式"></a>RabbiMQ模式</h3><blockquote>
<p>RabbitMQ模式大概分为以下三种:<br>(1)单一模式。<br>(2)普通模式(默认的集群模式)。<br>(3) 镜像模式(把需要的队列做成镜像队列，存在于多个节点，属于RabbiMQ的HA方案，在对业务可靠性要求较高的场合中比较适用)。<br>要实现镜像模式，需要先搭建一个普通集群模式，在这个模式的基础上再配置镜像模式以实现高可用。</p>
</blockquote>
<h3 id="RabbiMQ特点"><a href="#RabbiMQ特点" class="headerlink" title="RabbiMQ特点"></a>RabbiMQ特点</h3><blockquote>
<p>RabbitMQ的集群节点包括内存节点、磁盘节点。RabbitMQ支持消息的持久化<br>也就是数据写在磁盘上，最合适的方案就是既有内存节点，又有磁盘节点。</p>
</blockquote>
<h3 id="搭建环境："><a href="#搭建环境：" class="headerlink" title="搭建环境："></a>搭建环境：</h3><table>
<thead>
<tr>
<th>IP地址</th>
<th>主机名</th>
<th>操作系统</th>
<th>防火墙和SELinux</th>
<th>用途</th>
</tr>
</thead>
<tbody>
<tr>
<td>192.168.100.143</td>
<td>mq01</td>
<td>CentOS7.4(64位)</td>
<td>关闭</td>
<td>磁盘节点</td>
</tr>
<tr>
<td>192.168.100.144</td>
<td>mq02</td>
<td>CentOS7.4(64位)</td>
<td>关闭</td>
<td>内存节点</td>
</tr>
<tr>
<td>192.168.100.145</td>
<td>mq03</td>
<td>CentOS7.4(64位)</td>
<td>关闭</td>
<td>内存节点</td>
</tr>
</tbody>
</table>
<p>注意：RabbitMQ集群节点必须在同一网段里，如果是跨广域网，效果会变差。</p>
<h3 id="搭建步骤"><a href="#搭建步骤" class="headerlink" title="搭建步骤"></a>搭建步骤</h3><h4 id="1-配置hosts文件"><a href="#1-配置hosts文件" class="headerlink" title="1. 配置hosts文件"></a>1. 配置hosts文件</h4><p>更改三台MQ节点的计算机名分别为mq01、mq02 和mq03，然后修改hosts配置文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hostname    //其他两台相同,mq02,mq03</span><br><span class="line">mq01</span><br><span class="line"></span><br><span class="line">vi /etc/hosts</span><br><span class="line">192.168.100.143 mq01  //注意不能带.注意-主机名称也要更改</span><br><span class="line">192.168.100.144 mq02</span><br><span class="line">192.168.100.145 mq03</span><br></pre></td></tr></table></figure></p>
<p>注意：当主机名称不方便改动的情况，只修改hosts，同主机名就行</p>
<h4 id="2-安装erlang和rabbitmq-server软件"><a href="#2-安装erlang和rabbitmq-server软件" class="headerlink" title="2.安装erlang和rabbitmq-server软件"></a>2.安装erlang和rabbitmq-server软件</h4><p>在各个服务器上先安装好单机的rabbitmq，并能够成功启动，官方安装说明地址：<a href="https://www.rabbitmq.com/install-rpm.html#managing-service" target="_blank" rel="noopener">https://www.rabbitmq.com/install-rpm.html#managing-service</a>, 参考文件，选择合适的erlang和rabbitmq对应版本下载安装</p>
<p>由于服务器不可访问外网，所以本次通过官网下好rpm包，上传到服务器，再通过yum install安装<br>本次下载安装的版本为：<br>erlang-21.3.8.14-1.el7.x86_64.rpm 下载地址（<a href="https://bintray.com/rabbitmq-erlang/rpm/erlang）" target="_blank" rel="noopener">https://bintray.com/rabbitmq-erlang/rpm/erlang）</a><br>rabbitmq-server-3.8.3-1.el7.noarch.rpm 下载地址（<a href="https://bintray.com/rabbitmq/rpm/rabbitmq-server）" target="_blank" rel="noopener">https://bintray.com/rabbitmq/rpm/rabbitmq-server）</a></p>
<p>根据系统CentOS的版本（6.x,7.x,8.x）选择合适的版本(el6,el7,el8)下载</p>
<p>分别使用如下命令安装<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y erlang-21.3.8.14-1.el7.x86_64.rpm</span><br><span class="line">yum install -y rabbitmq-server-3.8.3-1.el7.noarch.rpm</span><br></pre></td></tr></table></figure></p>
<h4 id="3-修改rabbitmq-config配置"><a href="#3-修改rabbitmq-config配置" class="headerlink" title="3.修改rabbitmq config配置"></a>3.修改rabbitmq config配置</h4><p>上一步安装完成，便可以通过systemctl start rabbitmq-server启动rabbitmq服务，通过启动日记，可以发现其未找到config文件，以及数据路径和日记路径都采用默认，这里我们做下调整优化，可以让rabbitmq使用更大上限的File descriptor，Disk space等<br>rabbitmq默认的加载配置文件在/etc/rabbitmq路径下，在此路径下新建rabbitmq-env.conf文件，来指明数据和日记存储的磁盘路径，内容如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MNESIA_BASE=/data/rabbitmq/data</span><br><span class="line">LOG_BASE=/data/rabbitmq/log</span><br></pre></td></tr></table></figure></p>
<p>通过df -h查看发现挂载的/data下有很大磁盘空间，遂放置于此。同时注意新建的/data/rabbitmq文件拥有设置为rabbitmq<br>使用命令：<br><code>chown -R rabbitmq:rabbitmq /data/rabbitmq/</code></p>
<p>再新建rabbitmq.conf文件，内容如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">listeners.tcp.default = 5672</span><br><span class="line"></span><br><span class="line">channel_max = 655360</span><br><span class="line"># partition config</span><br><span class="line">cluster_partition_handling = autoheal</span><br><span class="line"></span><br><span class="line"># DANGER ZONE!</span><br><span class="line"># allowing remote connections for default user is highly discouraged</span><br><span class="line"># as it dramatically decreases the security of the system. Delete the user</span><br><span class="line"># instead and create a new one with generated secure credentials.</span><br><span class="line">loopback_users = none</span><br></pre></td></tr></table></figure></p>
<p>此处优化了channel_max的上限，cluster_partition_handling为网络分区策略设置为autoheal，参见文章最后，rabbitMq脑裂详解。配置loopback_users=none，使得默认账户guest/guest可以在非localhost的情况下登陆访问rabbitmq管理界面。</p>
<p>以上优化参数的配置，在官方文档中均有说明，同时提供example配置文件供参考</p>
<h4 id="4-安装管理插件"><a href="#4-安装管理插件" class="headerlink" title="4. 安装管理插件"></a>4. 安装管理插件</h4><p>RabbitMQ提供了一个非常友好的图形化监控页面插件（rabbitmq_management），让我们可以一目了然看见Rabbit的状态或集群状态。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/rabbitmq/bin/rabbitmq-plugins list //查看插件安装情况</span><br><span class="line"></span><br><span class="line">/usr/lib/rabbitmq/bin/rabbitmq-plugins enable rabbitmq_management //启用rabbitmq_management服务</span><br><span class="line"></span><br><span class="line">systemctl restart rabbitmq-server</span><br></pre></td></tr></table></figure></p>
<h4 id="5-调整最大可打开文件句柄限制"><a href="#5-调整最大可打开文件句柄限制" class="headerlink" title="5. 调整最大可打开文件句柄限制"></a>5. 调整最大可打开文件句柄限制</h4><p>默认情况下，操作系统限制的rabbitmq的最大操作文件句柄256，往往会限制到rabiitmq的性能提升，这里需要调整到65536</p>
<p>打开rabbitmq-server文件，位于系统：/usr/lib/systemd/system/rabbitmq-server.service，可通过systemctl status rabbitmq-server查看到，修改如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[Service]</span><br><span class="line">LimitNOFILE=65536</span><br></pre></td></tr></table></figure>
<h4 id="6-拷贝erlang-cookie"><a href="#6-拷贝erlang-cookie" class="headerlink" title="6.拷贝erlang.cookie"></a>6.拷贝erlang.cookie</h4><p>以上完成单一mq的服务部署，在三台服务器完成相同的部署操作，并能够成功启动，登陆访问管理界面。<br>Rabbitmq的集群是依附于erlang的集群来工作的,所以必须先构建起erlang的集群景象。Erlang的集群中各节点是经由过程一个magic cookie来实现的,这个cookie存放在/var/lib/rabbitmq/.erlang.cookie中，文件是400的权限。所以必须保证各节点cookie一致,不然节点之间就无法通信。<br>用scp的方式将mq01节点的.erlang.cookie的值复制到其他两个节点中。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp /var/lib/rabbitmq/.erlang.cookie root@192.168.100.144:/var/lib/rabbitmq/.erlang.cookie</span><br><span class="line"></span><br><span class="line">scp /var/lib/rabbitmq/.erlang.cookie root@192.168.100.145:/var/lib/rabbitmq/.erlang.cookie</span><br></pre></td></tr></table></figure></p>
<p>拷贝过程以及拷贝后注意文件权限问题。并重启三个服务应用。</p>
<h4 id="7-将mq02、mq03作为内存节点加入mq01节点集群中"><a href="#7-将mq02、mq03作为内存节点加入mq01节点集群中" class="headerlink" title="7.将mq02、mq03作为内存节点加入mq01节点集群中"></a>7.将mq02、mq03作为内存节点加入mq01节点集群中</h4><p>在mq02、mq03执行如下命令：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl stop_app    //停掉rabbit应用</span><br><span class="line">rabbitmqctl join_cluster --ram rabbit@mq01 //加入到磁盘节点</span><br><span class="line">rabbitmqctl start_app  //启动rabbit应用</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>（1）默认rabbitmq启动后是磁盘节点，在这个cluster命令下，mq02和mq03是内存节点，mq01是磁盘节点。<br>（2）如果要使mq02、mq03都是磁盘节点，去掉–ram参数即可。<br>（3）如果想要更改节点类型，可以使用命令rabbitmqctl change_cluster_node_type disc(ram),前提是必须停掉rabbit应用</p>
</blockquote>
<blockquote>
<p>在RabbitMQ集群集群中，必须至少有一个磁盘节点，否则队列元数据无法写入到集群中，当磁盘节点宕掉时，集群将无法写入新的队列元数据信息。</p>
</blockquote>
<h4 id="8-查看集群状态"><a href="#8-查看集群状态" class="headerlink" title="8.查看集群状态"></a>8.查看集群状态</h4><p>指令rabbitmqctl cluster_status或者登陆管理界面查看如图</p>
<p><img src="/img/RabbitMQ/rabbitmq.png" alt="rabbitmq-manage"></p>
<h4 id="9-RabbitMQ镜像集群配置"><a href="#9-RabbitMQ镜像集群配置" class="headerlink" title="9.RabbitMQ镜像集群配置"></a>9.RabbitMQ镜像集群配置</h4><blockquote>
<p>上面已经完成RabbitMQ默认集群模式，但并不保证队列的高可用性，尽管交换机、绑定这些可以复制到集群里的任何一个节点，但是队列内容不会复制。虽然该模式解决一项目组节点压力，但队列节点宕机直接导致该队列无法应用，只能等待重启，所以要想在队列节点宕机或故障也能正常应用，就要复制队列内容到集群里的每个节点，必须要创建镜像队列。<br>镜像队列是基于普通的集群模式的，然后再添加一些策略，所以你还是得先配置普通集群，然后才能设置镜像队列，我们就以上面的集群接着做。</p>
</blockquote>
<p>设置的镜像队列可以通过开启的网页的管理端，也可以通过命令，分别如下。<br>1.网页管理端创建rabbitmq策略<br>在mq01节点的控制台上创建策略<br>（1）点击admin菜单–&gt;右侧的Policies选项–&gt;左侧最下下边的Add/update a policy。<br>（2）按照图中的内容根据自己的需求填写。</p>
<blockquote>
<ul>
<li>Name:策略名称</li>
<li>Pattern：匹配的规则，^a这里表示匹配a开头的队列，如果是匹配所有的队列，那就是^.</li>
<li>Definition:使用ha-mode模式中的all，也就是同步所有匹配的队列。问号链接帮助文档。</li>
</ul>
</blockquote>
<p>（3）点击Add policy添加策略<br>此时分别登陆mq02、mq03两个节点的控制台，可以看到上面添加的这个策略</p>
<p>2.命令设置policy如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_policy [-p Vhost] Name Pattern Definition [Priority]</span><br><span class="line"></span><br><span class="line">-p Vhost： 可选参数，针对指定vhost下的queue进行设置</span><br><span class="line">Name: policy的名称</span><br><span class="line">Pattern: queue的匹配模式(正则表达式)</span><br><span class="line">Definition：镜像定义，包括三个部分ha-mode, ha-params, ha-sync-mode</span><br><span class="line">	ha-mode:指明镜像队列的模式，有效值为 all/exactly/nodes</span><br><span class="line">		all：表示在集群中所有的节点上进行镜像</span><br><span class="line">		exactly：表示在指定个数的节点上进行镜像，节点的个数由ha-params指定</span><br><span class="line">		nodes：表示在指定的节点上进行镜像，节点名称通过ha-params指定</span><br><span class="line">	ha-params：ha-mode模式需要用到的参数</span><br><span class="line">	ha-sync-mode：进行队列中消息的同步方式，有效值为automatic和manual</span><br><span class="line">priority：可选参数，policy的优先级</span><br><span class="line"></span><br><span class="line">例：rabbitmqctl set_policy ha-all &quot;^&quot; &apos;&#123;&quot;ha-mode&quot;:&quot;all&quot;,&quot;ha-sync-mode&quot;:&quot;automatic&quot;,&quot;ha-promote-on-shutdown&quot;:&quot;always&quot;,&quot;ha-promote-on-failure&quot;:&quot;always&quot;&#125;&apos;</span><br></pre></td></tr></table></figure></p>
<p>3.做破坏性测试<br>创建一个queue ab，像ab queue里发送一个message，自定义即可</p>
<p>1）将mq01节点的服务关闭，rabbitmqctl stop_app，再通过mq02和mq03查看消息记录是否还存在。从中可以看到ab队列已经从之前的+2显示成+1了，而且消息记录是存在的。</p>
<p>2）再将mq02节点的服务关闭，通过mq03查看消息记录是否还存在。从中可以看到ab队列和消息记录还是存在的，只是变成了一个节点了。</p>
<p>3）将mq01和mq02的服务再启动起来<br>从中可以看到ab队列后面+2变成了粉色，鼠标指上去显示镜像无法同步。如果这时候停掉mq03节点的服务，那么队列里面的消息将会丢失。</p>
<p>采取的解决办法是选择在mq02节点上执行同步命令。<br><code>rabbitmqctl sync_queue ab  //同步ab队列</code></p>
<p>同步完成后，+2又变成了蓝色。<br>这样，我们就测试了rabbitmq集群的破坏性测试，说明集群配置成功。</p>
<h4 id="10-其他功能指令使用"><a href="#10-其他功能指令使用" class="headerlink" title="10.其他功能指令使用"></a>10.其他功能指令使用</h4><p>新增账户：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl add_user barry barry@123</span><br><span class="line">rabbitmqctl list_users</span><br><span class="line">rabbitmqctl set_user_tags barry administrator</span><br><span class="line">rabbitmqctl list_users</span><br><span class="line">rabbitmqctl set_permissions -p / barry &apos;.*&apos; &apos;.*&apos; &apos;.*&apos;</span><br><span class="line">rabbitmqctl list_permissions barry</span><br><span class="line">rabbitmqctl list_user_permissions barry</span><br></pre></td></tr></table></figure></p>
<p>设置服务开机自启动<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable rabbitmq-server  //关闭disable</span><br></pre></td></tr></table></figure></p>
<p>查看并删除队列<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl list_queues</span><br><span class="line">rabbitmqctl delete_queue ***队列名</span><br></pre></td></tr></table></figure></p>
<h4 id="11-rabbitmq网络分区配置-脑裂详解"><a href="#11-rabbitmq网络分区配置-脑裂详解" class="headerlink" title="11.rabbitmq网络分区配置-脑裂详解"></a>11.rabbitmq网络分区配置-脑裂详解</h4><blockquote>
<p>集群和网络分区<br>RabbitMQ集群并不能很好的“忍受”网络分区。如果你想将RabbitMQ集群建立在广域网上，记住那是行不通的，除非你使用federation或者shovel等插件。然而有时候会有一些意想不到的事情发生。<br>RabbitMQ会将queues, exchanges, bindings等信息存储在Erlang的分布式数据库——Mnesia中，许多围绕网络分区的一些细节都和这个Mnesia的行为有关。<br>检测网络分区<br>如果另一个节点在一分钟（或者一个net_ticktime时间）内不能连接上一个节点，那么Mnesia通常任务这个节点已经挂了。就算之后两个节点连通（译者注：应该是指网络上的可连通），但是这两个节点都认为对方已经挂了，Mnesia此时认定发送了网络分区的情况。这些会被记录在RabbitMQ的日志中。<br>当一个节点起来的时候，RabbitMQ会记录是否发生了网络分区，你可以通过rabbitmqctl cluster_status这个命令或者管理插件看到相关信息。正常情况下，通过rabbitmqctl cluster_status命令查看到的信息中partitions那一项是空的。<br>然而当网络分区发生时，partitions内容就变了，同时管理界面也会有提示。<br>网络分区期间<br>当一个集群发生网络分区时，这个集群会分成两部分（或者更多），它们各自为政，互相都认为对方分区内的节点已经挂了， 包括queues, bindings, exchanges这些信息的创建和销毁都处于自身分区内，与其他分区无关。如果原集群中配置了镜像队列，而这个镜像队列又牵涉到两个（或者多个）网络分区的节点时，每一个网络分区中都会出现一个master节点（译者注：如果rabbitmq版本较新，分区节点个数充足，也会出现新的slave节点。），对于各个网络分区，此队列都是互相独立的。当然也会有一些其他未知的、怪异的事情发生。<br>当网络（这里只网络连通性，network connectivity）恢复时，网络分区的状态还是会保持，除非你采取了一些措施去解决他。<br>挂起/恢复导致的分区<br>当我们涉及到“网络分区”时，当集群中的不同的节点发生交互失败中断(communication interrupted)等，但是又没有节点挂掉这种情况下，才是发生了分区。然而除了网络失败(network failures)原因，操作系统的挂起或者恢复也会导致集群内节点的网络分区。因为发生挂起的节点不会认为自身已经失败或者停止工作，但是集群内的其他节点会这么认为。<br>如果一个集群中的一个节点运行在一台笔记本上，然后你合上了笔记本，这样这个节点就挂起了。或者说一种更常见的现象，节点运行在某台虚拟机上，然后虚拟机的管理程序挂起了这个虚拟机节点，这样也可能发生挂起。<br>由于挂起/恢复导致的分区并不对称——挂起的节点将看不到其他节点是否消失，但是集群中剩余的节点可以观察到，这一点貌似暗示了pause_minority这种模式（下面会涉及到）。<br>从网络分区中恢复<br>未来从网络分区中恢复，首先需要挑选一个信任的分区，这个分区才有决定Mnesia内容的权限，发生在其他分区的改变将不被记录到Mnesia中而直接丢弃。<br>停止（stop）其他分区的节点，然后启动(start)这些节点，之后重新将这些节点加入到当前信任的分区之中。<br>最后，你应该重启(restart)信任的分区中所有的节点，以去除告警。<br>你也可以简单的关闭整个集群的节点，然后再启动每一个节点，当然，你要确保你启动的第一个节点在你所信任的分区之中。<br>自动处理分区<br>RabbitMQ提供了三种方法自动的解决网络分区：pause-minority mode, pause-if-all-down mode以及autoheal mode。（默认的是ignore模式）<br>在pause-minority mode下，顾名思义，当发生网络分区时，集群中的节点在观察到某些节点“丢失”时，会自动检测其自身是否处于少数派（小于或者等于集群中一半的节点数），RabbitMQ会自动关闭这些节点的运作。根据CAP原理来说，这里保障了P，即分区耐受性（partition tolerance）。这样确保了在发生网络分区的情况下，大多数节点（当然这些节点在同一个分区中）可以继续运行。“少数派”中的节点在分区发生时会关闭，当分区结束时又会启动。<br>在pause-if-all-down mode下，RabbitMQ在集群中的节点不能和list中的任何节点交互时才会关闭集群的节点（{pause_if_all_down, [nodes], ignore | autoheal}，list即[nodes]中的节点）。也就是说，只有在list中所有的节点失败时才会关闭集群的节点。这个模式和pause-minority mode有点相似，但是，这个模式允许管理员的任命而挑选信任的节点，而不是根据上下文关系。举个案例，一个集群，有四个节点，2个节点在A机架上，另2个节点在B机架上，此时A机架和B机架的连接丢失，那么根据pause-minority mode所有的节点都将被关闭。<br>在autoheal mode下，当认为发生网络分区时，RabbitMQ会自动决定一个获胜（winning）的分区，然后重启不在这个分区中的节点。<br>一个获胜的分区（a winning partition）是指客户端连接最多的一个分区。（如果产生一个平局，即有两个（或多个）分区的客户端连接数一样多，那么节点数最多的一个分区就是a winning partition. 如果此时节点数也一样多，将会以一个未知的方式挑选winning partition.）<br>你可以通过在RabbitMQ配置文件中设置cluster_partition_handling参数使下面任何一种模式生效：<br>pause_minority<br>{pause_if_all_down, [nodes], ignore | autoheal}<br>autoheal<br>我该挑选那种模式？<br>有一点必须要清楚，允许RabbitMQ能够自动的处理网络分区并不一定会有正面的成效，也有能会带来更多的问题。网络分区会导致RabbitMQ集群产生众多的问题，你需要对你所遇到的问题作出一定的选择。就像本文开篇所说的，如果你置RabbitMQ集群于一个不可靠的网络环境下，你需要使用federation或者shovel插件。<br>你可能选择如下的恢复模式：<br>ignore: 你的网络很可靠，所有的节点都在一个机架上，连接在同一个交换机上，这个交换机也连接在WAN上，你不需要冒险而关闭部分节点。（或者适合只有两个节点的集群。）<br>pause_minority: 你的网络相对没有那么的可靠。比如你在EC2上建立了三个节点的集群，假设其中一个节点宕了，在这种策略下，剩余的两个节点还可以继续工作，失败的节点可以在恢复之后重新加入集群<br>autoheal: 你的网络非常不可靠，你更关心服务的连续性而不是数据的完整性。适合有两个节点的集群。<br>有关pause-minority模式的更多信息<br>关闭的RabbitMQ节点所在主机上的Erlang虚拟机还是在正常运行，但是此节点并不会监听任何端口也不会执行其他任务。这些节点每秒会检测一次剩下的集群节点是否会再次出现，如果出现，就启动自己继续运行。<br>注意上面所说的“关闭的RabbitMQ节点”并不会在启动时就进入关闭状态，即使它们在“少数派（minority）”。这些“少数派”可能在“剩余的集群节点”没有启动好之前就启动了。<br>同样需要注意的是RabbitMQ也会关闭不是严格意义上的“大多数（majority）”——数量超过集群的一半。因此在一个集群只有两个节点的时候并不适合采用pause-minority模式，因为由于其中任何一个节点失败而发生网络分区时，两个节点都会被关闭。然而如果集群中的节点个数远大于两个时，pause_minority模式比ignore模式更加的可靠，特别是网络分区通常是由于单个节点掉出网络。<br>最后，需要注意的是pause_minority模式将不会防止由于集群节点被挂起而导致的分区。这是因为挂起的节点将永远不会看到集群的其余部分的消失，因此将没有触发器将其从集群中断开。</p>
</blockquote>

	</div>

	
	<!-- css -->
	<style type="text/css">
	    .center {
	        text-align: center;
	    }
	    .hidden {
	        display: none;
	    }
		.donate_bar a.btn_donate{
			display: inline-block;
			width: 82px;
			height: 82px;
			background: url("/img/btn_reward.gif") no-repeat;
			_background: url("/img/btn_reward.gif") no-repeat;

			<!-- http://img.t.sinajs.cn/t5/style/images/apps_PRF/e_media/btn_reward.gif
			     因为本 hexo 生成的博客所用的 theme 的 a:hover 带动画效果，
				 为了在让打赏按钮显示效果正常 而 添加了以下几行 css，
				 嵌入其它博客时不一定要它们。-->
			-webkit-transition: background 0s;
			-moz-transition: background 0s;
			-o-transition: background 0s;
			-ms-transition: background 0s;
			transition: background 0s;
			<!-- /让打赏按钮的效果显示正常 而 添加的几行 css 到此结束-->
		}

		.donate_bar a.btn_donate:hover{ background-position: 0px -82px;}
		.donate_bar .donate_txt {
			display: block;
			color: #9d9d9d;
			font: 14px/2 "Microsoft Yahei";
		}
		.bold{ font-weight: bold; }
	</style>
	<!-- /css -->

    <!-- Donate Module -->
    <div id="donate_module">

	<!-- btn_donate & tips -->
	<div id="donate_board" class="donate_bar center">
	    <br>
	    ------------------------------------------------------------------------------------------------------------------------------
	    <br>
		<a id="btn_donate" class="btn_donate" target="_self" href="javascript:;" title="Donate 打赏"></a>
		<span class="donate_txt">
			打赏我的人，运气都不会太差哦~
		</span>


	</div>
	<!-- /btn_donate & tips -->

	<!-- donate guide -->

	<div id="donate_guide" class="donate_bar center hidden">
        <br>
	    ------------------------------------------------------------------------------------------------------------------------------
	    <br>
	    

		<a href="/img/006qxJmqgy1fu5w4jmxxsj307w08ot9i.jpg" title="用微信扫一扫哦~" class="fancybox" rel="article0">
			<img src="/img/006qxJmqgy1fu5w4jmxxsj307w08ot9i.jpg" title="微信打赏 Donate" height="190px" width="auto"/>
		</a>

        &nbsp;&nbsp;

		<a href="/img/006qxJmqgy1fu5w4ly4ovj308x08oab4.jpg" title="用支付宝扫一扫即可~" class="fancybox" rel="article0">
			<img src="/img/006qxJmqgy1fu5w4ly4ovj308x08oab4.jpg" title="支付宝打赏 Donate" height="190px" width="auto"/>
		</a>

		<span class="donate_txt">
			打赏我的人，运气都不会太差哦~
		</span>

	</div>
	<!-- /donate guide -->

	<!-- donate script -->
	<script type="text/javascript">
		document.getElementById('btn_donate').onclick = function() {
			$('#donate_board').addClass('hidden');
	    $('#donate_guide').removeClass('hidden');
		}

		function donate_on_web(){
			$('#donate').submit();
        }

		var original_window_onload = window.onload;
        window.onload = function () {
            if (original_window_onload) {
                original_window_onload();
            }
            document.getElementById('donate_board_wdg').className = 'hidden';
		}
	</script>
	<!-- /donate script -->
</div>
<!-- /Donate Module -->
   
		<footer class="article-footer clearfix">
<div class="article-catetags">

<div class="article-categories">
  <span></span>
  <a class="article-category-link" href="/categories/rabbitmq/">rabbitmq</a>
</div>


  <div class="article-tags">
  
  <span></span> <a href="/tags/rabbitmq安装/">rabbitmq安装</a>
  </div>

</div>



	<div class="article-share" id="share">
	
	  <div data-url="http://macintosh-c.coding.me/2020/06/12/mq/RabbitMQ/RabbitMq集群搭建/" data-title="RabbitMq集群搭建 | macintosh-c&#39;s blog" data-tsina="" class="share clearfix">
	  </div>
	
	</div>


</footer>

	</article>
	
<nav class="article-nav clearfix">
 
 <div class="prev" >
 <a href="/2020/06/12/MarkDown/markdown语法2/" title="MarkDown添加图片的三种方式">
  <strong>上一篇：</strong><br/>
  <span>
  MarkDown添加图片的三种方式</span>
</a>
</div>


<div class="next">
<a href="/2020/06/08/Databases/sqlservice/Mac下docker安装sqlservice/"  title="Mac上使用docker安装sql server">
 <strong>下一篇：</strong><br/> 
 <span>Mac上使用docker安装sql server
</span>
</a>
</div>

</nav>

	




	<div id="lv-container" data-id="city" data-uid="MTAyMC8zODk4Mi8xNTUwOQ==">
	<script type="text/javascript">
	   (function(d, s) {
	       var j, e = d.getElementsByTagName(s)[0];

	       if (typeof LivereTower === 'function') { return; }

	       j = d.createElement(s);
	       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
	       j.async = true;

	       e.parentNode.insertBefore(j, e);
	   })(document, 'script');
	</script>
	<noscript>为正常使用来必力评论功能请激活JavaScript</noscript>
	</div>


</div>

      <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>

  <div id="toc" class="toc-aside">
  <strong class="toc-title">文章目录</strong>
 
 <ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbiMQ简介"><span class="toc-number">1.</span> <span class="toc-text">RabbiMQ简介</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbiMQ模式"><span class="toc-number">2.</span> <span class="toc-text">RabbiMQ模式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#RabbiMQ特点"><span class="toc-number">3.</span> <span class="toc-text">RabbiMQ特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建环境："><span class="toc-number">4.</span> <span class="toc-text">搭建环境：</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#搭建步骤"><span class="toc-number">5.</span> <span class="toc-text">搭建步骤</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-配置hosts文件"><span class="toc-number">5.1.</span> <span class="toc-text">1. 配置hosts文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-安装erlang和rabbitmq-server软件"><span class="toc-number">5.2.</span> <span class="toc-text">2.安装erlang和rabbitmq-server软件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-修改rabbitmq-config配置"><span class="toc-number">5.3.</span> <span class="toc-text">3.修改rabbitmq config配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-安装管理插件"><span class="toc-number">5.4.</span> <span class="toc-text">4. 安装管理插件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-调整最大可打开文件句柄限制"><span class="toc-number">5.5.</span> <span class="toc-text">5. 调整最大可打开文件句柄限制</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-拷贝erlang-cookie"><span class="toc-number">5.6.</span> <span class="toc-text">6.拷贝erlang.cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-将mq02、mq03作为内存节点加入mq01节点集群中"><span class="toc-number">5.7.</span> <span class="toc-text">7.将mq02、mq03作为内存节点加入mq01节点集群中</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-查看集群状态"><span class="toc-number">5.8.</span> <span class="toc-text">8.查看集群状态</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-RabbitMQ镜像集群配置"><span class="toc-number">5.9.</span> <span class="toc-text">9.RabbitMQ镜像集群配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-其他功能指令使用"><span class="toc-number">5.10.</span> <span class="toc-text">10.其他功能指令使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-rabbitmq网络分区配置-脑裂详解"><span class="toc-number">5.11.</span> <span class="toc-text">11.rabbitmq网络分区配置-脑裂详解</span></a></li></ol></li></ol>
 
  </div>

<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">

  
<div class="github-card">
<p class="asidetitle">Github 名片</p>
<div class="github-card" data-github="Macintosh-c" data-theme="medium"></div>
<script type="text/javascript" src="//cdn.jsdelivr.net/github-cards/latest/widget.js" ></script>
</div>



  
<div class="categorieslist">
	<p class="asidetitle">分类</p>
		<ul>
		
		  
			<li><a href="/categories/Ansible/" title="Ansible">Ansible<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Docker/" title="Docker">Docker<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/Ehcache/" title="Ehcache">Ehcache<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Git/" title="Git">Git<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Kubernetes/" title="Kubernetes">Kubernetes<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Linux/" title="Linux">Linux<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Markdown/" title="Markdown">Markdown<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Maven/" title="Maven">Maven<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/Memcache/" title="Memcache">Memcache<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Mysql/" title="Mysql">Mysql<sup>7</sup></a></li>
		  
		
		  
			<li><a href="/categories/Postgre/" title="Postgre">Postgre<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Redis/" title="Redis">Redis<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/SonarQube/" title="SonarQube">SonarQube<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Spring-cloud/" title="Spring cloud">Spring cloud<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/SpringMVC/" title="SpringMVC">SpringMVC<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/Springboot/" title="Springboot">Springboot<sup>5</sup></a></li>
		  
		
		  
			<li><a href="/categories/SqlService/" title="SqlService">SqlService<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/VirtualBox/" title="VirtualBox">VirtualBox<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/java基础/" title="java基础">java基础<sup>6</sup></a></li>
		  
		
		  
			<li><a href="/categories/jenkins/" title="jenkins">jenkins<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/kafka/" title="kafka">kafka<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/mybatis/" title="mybatis">mybatis<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/nginx/" title="nginx">nginx<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/python/" title="python">python<sup>1</sup></a></li>
		  
		
		  
			<li><a href="/categories/rabbitmq/" title="rabbitmq">rabbitmq<sup>2</sup></a></li>
		  
		
		  
			<li><a href="/categories/博客相关/" title="博客相关">博客相关<sup>3</sup></a></li>
		  
		
		  
			<li><a href="/categories/成长之路/" title="成长之路">成长之路<sup>1</sup></a></li>
		  
		
		</ul>
</div>


  
<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
		
			
				<li><a href="/tags/Docker/" title="Docker">Docker<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/blog搭建/" title="blog搭建">blog搭建<sup>3</sup></a></li>
			
		
			
				<li><a href="/tags/ansible详解/" title="ansible详解">ansible详解<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Markdown/" title="Markdown">Markdown<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Maven/" title="Maven">Maven<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/mysql安装/" title="mysql安装">mysql安装<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/sql语句基础/" title="sql语句基础">sql语句基础<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Ehcache/" title="Ehcache">Ehcache<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/rabbitmq安装/" title="rabbitmq安装">rabbitmq安装<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/fastjson/" title="fastjson">fastjson<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/设计模式/" title="设计模式">设计模式<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Springboot/" title="Springboot">Springboot<sup>2</sup></a></li>
			
		
			
				<li><a href="/tags/Dockerfile/" title="Dockerfile">Dockerfile<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Git基础/" title="Git基础">Git基础<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/jenkins用户权限管理/" title="jenkins用户权限管理">jenkins用户权限管理<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Docker-Compose/" title="Docker-Compose">Docker-Compose<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/Linux基础/" title="Linux基础">Linux基础<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/VirtualBox安装/" title="VirtualBox安装">VirtualBox安装<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/jenkins/" title="jenkins">jenkins<sup>1</sup></a></li>
			
		
			
				<li><a href="/tags/nginx/" title="nginx">nginx<sup>1</sup></a></li>
			
		
		</ul>
</div>


  
  <div class="archiveslist">
    <p class="asidetitle"><a href="/archives">归档</a></p>
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">七月 2020</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">六月 2020</a><span class="archive-list-count">4</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">四月 2020</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">三月 2020</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">十二月 2019</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">十月 2019</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">九月 2019</a><span class="archive-list-count">17</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">八月 2019</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">九月 2018</a><span class="archive-list-count">3</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">八月 2018</a><span class="archive-list-count">12</span></li></ul>
  </div>


  
  <div class="tagcloudlist">
    <p class="asidetitle">标签云</p>
    <div class="tagcloudlist clearfix">
       <a href="/tags/Docker/" style="font-size: 20px;">Docker</a> <a href="/tags/Docker-Compose/" style="font-size: 10px;">Docker-Compose</a> <a href="/tags/Dockerfile/" style="font-size: 10px;">Dockerfile</a> <a href="/tags/Ehcache/" style="font-size: 15px;">Ehcache</a> <a href="/tags/Git基础/" style="font-size: 10px;">Git基础</a> <a href="/tags/Kubernetes安装/" style="font-size: 10px;">Kubernetes安装</a> <a href="/tags/Linux基础/" style="font-size: 10px;">Linux基础</a> <a href="/tags/Markdown/" style="font-size: 15px;">Markdown</a> <a href="/tags/Maven/" style="font-size: 15px;">Maven</a> <a href="/tags/Memcached安装/" style="font-size: 10px;">Memcached安装</a> <a href="/tags/Postgre安装/" style="font-size: 10px;">Postgre安装</a> <a href="/tags/Redis批量写入/" style="font-size: 10px;">Redis批量写入</a> <a href="/tags/SonarQube/" style="font-size: 10px;">SonarQube</a> <a href="/tags/Spring-aop/" style="font-size: 10px;">Spring aop</a> <a href="/tags/Spring-cloud/" style="font-size: 10px;">Spring cloud</a> <a href="/tags/Springboot/" style="font-size: 15px;">Springboot</a> <a href="/tags/Springboot-response/" style="font-size: 10px;">Springboot response</a> <a href="/tags/Springboot-test/" style="font-size: 10px;">Springboot test</a> <a href="/tags/SqlService安装/" style="font-size: 10px;">SqlService安装</a> <a href="/tags/VirtualBox安装/" style="font-size: 10px;">VirtualBox安装</a> <a href="/tags/ansible详解/" style="font-size: 15px;">ansible详解</a> <a href="/tags/blog搭建/" style="font-size: 20px;">blog搭建</a> <a href="/tags/fastjson/" style="font-size: 15px;">fastjson</a> <a href="/tags/jdk安装/" style="font-size: 10px;">jdk安装</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/jenkins用户权限管理/" style="font-size: 10px;">jenkins用户权限管理</a> <a href="/tags/kafka安装/" style="font-size: 10px;">kafka安装</a> <a href="/tags/log4j日志/" style="font-size: 10px;">log4j日志</a> <a href="/tags/mybatis基础/" style="font-size: 10px;">mybatis基础</a> <a href="/tags/mysql主从/" style="font-size: 10px;">mysql主从</a> <a href="/tags/mysql安装/" style="font-size: 15px;">mysql安装</a> <a href="/tags/nginx/" style="font-size: 10px;">nginx</a> <a href="/tags/python安装/" style="font-size: 10px;">python安装</a> <a href="/tags/rabbitmq安装/" style="font-size: 15px;">rabbitmq安装</a> <a href="/tags/redis安装/" style="font-size: 10px;">redis安装</a> <a href="/tags/redis指令/" style="font-size: 10px;">redis指令</a> <a href="/tags/serialVersionUID/" style="font-size: 10px;">serialVersionUID</a> <a href="/tags/sql案例/" style="font-size: 10px;">sql案例</a> <a href="/tags/sql语句基础/" style="font-size: 15px;">sql语句基础</a> <a href="/tags/基本概念/" style="font-size: 10px;">基本概念</a> <a href="/tags/设计模式/" style="font-size: 15px;">设计模式</a> <a href="/tags/随笔/" style="font-size: 10px;">随笔</a>
    </div>
  </div>


  <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
        
          <li>
            
            	<a href="http://toutiao.io/" target="_blank" title="开发者头条">开发者头条</a>
            
          </li>
        
          <li>
            
            	<a href="http://blog.csdn.net/peace1213" target="_blank" title="csdn">csdn</a>
            
          </li>
        
    </ul>
</div>

  <div class="rsspart">
	<a href="/atom.xml" target="_blank" title="rss">RSS 订阅</a>
</div>

</aside>
</div>
    </div>
    <footer><div id="footer" >
	
	<div class="line">
		<span></span>
		<div class="author"></div>
	</div>
	
	
	<section class="info">
		<p> 静下心来，好好做你该做的事！ <br/>
			This is my blog,Try to do better.</p>
	</section>
	 
	<div class="social-font" class="clearfix">
		
		
		<a href="https://github.com/Macintosh-c" target="_blank" class="icon-github" title="github"></a>
		
		
		
		
		
		
		
		
		
	</div>
			
		

		<p class="copyright">
		Powered by <a href="http://hexo.io" target="_blank" title="hexo">hexo</a> and Theme by <a href="https://github.com/wuchong/jacman" target="_blank" title="Jacman">Jacman</a> © 2020
		
		<a href="/about" target="_blank" title="Macintosh-c">Macintosh-c</a>
		
		</br>
				<script async src="http://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
		<span id="busuanzi_container_site_pv">
		    &nbsp;&nbsp;Total visits:&nbsp;<span id="busuanzi_value_site_pv"></span>
		</span>
		<span id="busuanzi_container_site_uv">
		  &nbsp;&nbsp;You are Visiter No.<span id="busuanzi_value_site_uv"></span>
		</span>
		</p>

</div>
</footer>
    <script src="/js/jquery-2.0.3.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>
<script src="/js/jquery.qrcode-0.12.0.min.js"></script>

<script type="text/javascript">
$(document).ready(function(){ 
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    $('#toc.toc-aside').css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');      
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  
        getSize();
        if (myWidth >= 1024) {
          c.click();
        }
  
  $(window).resize(function(){
    getSize(); 
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else{
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
      
      $('#toc.toc-aside').css('display', 'none');
        
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){ 
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  c.click(function(){
    ta.css('display', 'block').addClass('fadeIn');
  });
  o.click(function(){
    ta.css('display', 'none');
  });
  $(window).scroll(function(){
    ta.css("top",Math.max(140,320-$(this).scrollTop()));
  });
});
</script>


<script type="text/javascript">
$(document).ready(function(){ 
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina'),
      description = $this.attr('description');
  var html = [
  '<div class="hoverqrcode clearfix"></div>',
  '<a class="overlay" id="qrcode"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="微信"></a>',
  '<a href="http://widget.renren.com/dialog/share?resourceUrl=' + encodedUrl + '&srcUrl=' + encodedUrl + '&title=' + title +'" class="article-share-renren" target="_blank" title="人人"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="微博"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);

  $('.hoverqrcode').hide();

  var myWidth = 0;
  function updatehoverqrcode(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
    var qrsize = myWidth > 1024 ? 200:100;
    var options = {render: 'image', size: qrsize, fill: '#2ca6cb', text: url, radius: 0.5, quiet: 1};
    var p = $('.article-share-qrcode').position();
    $('.hoverqrcode').empty().css('width', qrsize).css('height', qrsize)
                          .css('left', p.left-qrsize/2+20).css('top', p.top-qrsize-10)
                          .qrcode(options);
  };
  $(window).resize(function(){
    $('.hoverqrcode').hide();
  });
  $('.article-share-qrcode').click(function(){
    updatehoverqrcode();
    $('.hoverqrcode').toggle();
  });
  $('.article-share-qrcode').hover(function(){}, function(){
      $('.hoverqrcode').hide();
  });
});   
</script>











<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){ 
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
}); 
</script>



<!-- Analytics Begin -->



  <script>
  var _hmt = _hmt || [];
  (function() {
    var hm = document.createElement("script");
    hm.src = "https://hm.baidu.com/hm.js?3491d96f9fc7f28103bc4230e5fca4e0";
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(hm, s);
  })();
  </script>




<!-- Analytics End -->

<!-- Totop Begin -->

	<div id="totop">
	<a title="返回顶部"><img src="/img/scrollup.png"/></a>
	</div>
	<script src="/js/totop.js"></script>

<!-- Totop End -->

<!-- MathJax Begin -->
<!-- mathjax config similar to math.stackexchange -->


<!-- MathJax End -->

<!-- Tiny_search Begin -->

<!-- Tiny_search End -->
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
<script>
(function(){
var src = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?485f6dcaf5a398e5f4565997bbc23f63":"https://jspassport.ssl.qhimg.com/11.0.1.js?485f6dcaf5a398e5f4565997bbc23f63";
document.write('<script src="' + src + '" id="sozz"><\/script>');
})();
</script>
  </body>
</html>
